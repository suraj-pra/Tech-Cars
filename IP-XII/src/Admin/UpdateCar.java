/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Admin;

import Both.Pane;
import java.io.File;
import javax.swing.JFileChooser;

/**
 *
 * @author Suraj
 */
public class UpdateCar extends javax.swing.JFrame {

    /**
     * Creates new form UpdateCar
     */
    
    java.sql.Statement stmt;
    
    String brand = null, model = null, sub = null;
    String opimg, optxt;
    
    CarDetails c;
    
    public UpdateCar(CarDetails c, String brand, String model, String sub) {
        this.c = c;
        this.brand = brand;
        this.model = model;
        this.sub = sub;
        initComponents();
    }

    private UpdateCar() {
        throw new UnsupportedOperationException("Not supported yet."); //To change body of generated methods, choose Tools | Templates.
    }
    
    public String readUsingFiles(String fileName) throws java.io.IOException {
        java.nio.file.Path path = java.nio.file.Paths.get(fileName);
        byte[] bytes = java.nio.file.Files.readAllBytes(path);
        @SuppressWarnings("unused")
                java.util.List<String> allLines = java.nio.file.Files.readAllLines(path, java.nio.charset.StandardCharsets.UTF_8);
        return (new String(bytes));
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        panel = new javax.swing.JPanel();
        name = new javax.swing.JTextField();
        price = new javax.swing.JTextField();
        trans = new javax.swing.JTextField();
        oil = new javax.swing.JTextField();
        nm = new javax.swing.JLabel();
        prc = new javax.swing.JLabel();
        trns = new javax.swing.JLabel();
        ol = new javax.swing.JLabel();
        pic = new javax.swing.JLabel();
        updt = new javax.swing.JLabel();
        scrollpane = new javax.swing.JScrollPane();
        desc = new javax.swing.JTextArea();
        bdesc = new javax.swing.JButton();
        bimg = new javax.swing.JButton();
        back = new javax.swing.JLabel();
        minimize = new javax.swing.JLabel();
        exit = new javax.swing.JLabel();
        blk = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setUndecorated(true);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowOpened(java.awt.event.WindowEvent evt) {
                formWindowOpened(evt);
            }
        });
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        panel.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        name.setFont(new java.awt.Font("Consolas", 1, 14)); // NOI18N
        name.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        panel.add(name, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 30, 360, 30));

        price.setFont(new java.awt.Font("Consolas", 1, 14)); // NOI18N
        price.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        price.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                priceKeyReleased(evt);
            }
        });
        panel.add(price, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 110, 360, 30));

        trans.setFont(new java.awt.Font("Consolas", 1, 14)); // NOI18N
        trans.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        panel.add(trans, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 160, 360, 30));

        oil.setFont(new java.awt.Font("Consolas", 1, 14)); // NOI18N
        oil.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        panel.add(oil, new org.netbeans.lib.awtextra.AbsoluteConstraints(130, 210, 360, 30));

        nm.setFont(new java.awt.Font("Consolas", 1, 14)); // NOI18N
        nm.setText("Name:");
        panel.add(nm, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 30, 50, 20));

        prc.setFont(new java.awt.Font("Consolas", 1, 14)); // NOI18N
        prc.setText("Price:");
        panel.add(prc, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 120, 60, 20));

        trns.setFont(new java.awt.Font("Consolas", 1, 14)); // NOI18N
        trns.setText("Transmission:");
        panel.add(trns, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 170, 110, 20));

        ol.setFont(new java.awt.Font("Consolas", 1, 14)); // NOI18N
        ol.setText("Oil Type:");
        panel.add(ol, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 220, 80, 20));

        pic.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        pic.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Consolas", 1, 12), new java.awt.Color(204, 0, 102))); // NOI18N
        panel.add(pic, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 260, 460, 210));

        updt.setIcon(new javax.swing.ImageIcon(getClass().getResource("/img/Update Car Btn.PNG"))); // NOI18N
        updt.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                updtMouseClicked(evt);
            }
        });
        panel.add(updt, new org.netbeans.lib.awtextra.AbsoluteConstraints(660, 430, -1, 40));

        desc.setColumns(20);
        desc.setRows(5);
        desc.setToolTipText("");
        desc.setBorder(javax.swing.BorderFactory.createTitledBorder("Modify Key Features"));
        desc.setOpaque(false);
        scrollpane.setViewportView(desc);

        panel.add(scrollpane, new org.netbeans.lib.awtextra.AbsoluteConstraints(500, 60, 330, 260));

        bdesc.setText("Or Browse desc");
        bdesc.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                bdescActionPerformed(evt);
            }
        });
        panel.add(bdesc, new org.netbeans.lib.awtextra.AbsoluteConstraints(700, 330, -1, -1));

        bimg.setText("Browse image");
        bimg.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                bimgActionPerformed(evt);
            }
        });
        panel.add(bimg, new org.netbeans.lib.awtextra.AbsoluteConstraints(480, 430, -1, -1));

        getContentPane().add(panel, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 50, 850, 490));

        back.setIcon(new javax.swing.ImageIcon(getClass().getResource("/img/back btn.png"))); // NOI18N
        back.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                backMouseClicked(evt);
            }
        });
        getContentPane().add(back, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 0, 30, 40));

        minimize.setIcon(new javax.swing.ImageIcon(getClass().getResource("/img/min.png"))); // NOI18N
        minimize.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                minimizeMouseClicked(evt);
            }
        });
        getContentPane().add(minimize, new org.netbeans.lib.awtextra.AbsoluteConstraints(770, 0, -1, 40));

        exit.setIcon(new javax.swing.ImageIcon(getClass().getResource("/img/exit.png"))); // NOI18N
        exit.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                exitMouseClicked(evt);
            }
        });
        getContentPane().add(exit, new org.netbeans.lib.awtextra.AbsoluteConstraints(810, 0, -1, 40));

        blk.setBackground(new java.awt.Color(0, 0, 0));
        blk.setOpaque(true);
        getContentPane().add(blk, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 850, 40));

        pack();
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents

    private void updtMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_updtMouseClicked
        int n;
        
        try {
            String q = "Select count(*) from " + brand + " where submodel = \"" + name.getText() + "\";";
            java.sql.ResultSet rs = stmt.executeQuery(q);
            rs.first();

            n = rs.getInt("count(*)");
            
            if(n == 0 || name.getText().equals(sub)){
                if((trans.getText().equals("Automatic") || trans.getText().equals("Manual")) && (oil.getText().equals("Diesel") || oil.getText().equals("Petrol"))){
                    String query = "Update " + brand + " set submodel = \"" + name.getText() + "\", price = \"" + price.getText() + "\", transmission = \"" + trans.getText() + "\", oil_type = \"" + oil.getText() + "\" where submodel = \"" + sub + "\";";
                    stmt.executeUpdate(query);
                    
                    {
                        try {
                            javax.imageio.ImageIO.write(javax.imageio.ImageIO.read(new File(pic.getIcon().toString())), "png", new File("D:\\temp\\" + name.getText() + ".png"));
                            
                            new File(optxt).delete();
                            new File(opimg).delete();
                            
                            java.io.PrintWriter w = new java.io.PrintWriter("D:\\Path\\" + brand + "\\" + model + "\\" + name.getText() + ".txt", "UTF-8");
                            w.print(desc.getText());
                            w.close();
                            javax.imageio.ImageIO.write(javax.imageio.ImageIO.read(new File("D:\\temp\\" + name.getText() + ".png")), "png", new File("D:\\Path\\" + brand + "\\" + model + "\\" + name.getText() + ".png"));
                            
                            new File("D:\\temp\\" + name.getText() + ".txt").delete();
                            new File("D:\\temp\\" + name.getText() + ".png").delete();
                        } catch (Exception e) {
                            javax.swing.JOptionPane.showMessageDialog(null, e);
                        }
                    }
                    
                    c.name.setText(name.getText());
                    c.price.setText(price.getText());
                    c.trans.setText(trans.getText());
                    c.oil.setText(oil.getText());
                    c.desc.setText(desc.getText());
                    c.pic.setIcon(pic.getIcon());
                    c.stmt = stmt;
                    c.setVisible(true);
                    this.dispose();
                    Pane p = new Pane(this);
                    p.txt.setText("Your details are successfully updated.");
                    p.yes.setVisible(false);
                    p.no.setVisible(false);
                    p.setVisible(true);
                }
                else{
                    Pane p = new Pane(this);
                    p.top.setText("You haven't written the correct transmission or oil type.");
                    p.txt.setText("Allowed values are (Automatic or Manual) and (Petrol or Diesel)");
                    p.yes.setVisible(false);
                    p.no.setVisible(false);
                    p.setVisible(true);
                }
            }
            else{
                Pane p = new Pane(this);
                p.txt.setText("The name already exists.");
                p.yes.setVisible(false);
                p.no.setVisible(false);
                p.setVisible(true);
            }
        }
        catch (Exception e){
            javax.swing.JOptionPane.showMessageDialog(null, e);
        }
    }//GEN-LAST:event_updtMouseClicked

    private void bimgActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_bimgActionPerformed
        JFileChooser fc = new JFileChooser();
        int n = fc.showOpenDialog(null);
        String imgName = null;
        if(n == JFileChooser.APPROVE_OPTION){
            imgName = fc.getSelectedFile().getAbsolutePath();
            if(imgName.toLowerCase().endsWith(".png"))
                pic.setIcon(new javax.swing.ImageIcon(imgName));
            else{
                Pane p = new Pane(this);
                p.txt.setText("This is not a \".png\" file.");
                p.yes.setVisible(false);
                p.no.setVisible(false);
                p.setVisible(true);
            }
        }
    }//GEN-LAST:event_bimgActionPerformed

    private void bdescActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_bdescActionPerformed
        JFileChooser fc = new JFileChooser();
        int n = fc.showOpenDialog(null);
        String txtName = null;
        if(n == JFileChooser.APPROVE_OPTION){
            txtName = fc.getSelectedFile().getAbsolutePath();
            if(txtName.toLowerCase().endsWith(".txt")){
                try {
                    desc.setText(readUsingFiles(txtName));
                } catch (Exception e) {
                    javax.swing.JOptionPane.showMessageDialog(null, e);
                }
            }
            else{
                Pane p = new Pane(this);
                p.txt.setText("This is not a \".txt\" file.");
                p.yes.setVisible(false);
                p.no.setVisible(false);
                p.setVisible(true);
            }
        }
    }//GEN-LAST:event_bdescActionPerformed

    private void priceKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_priceKeyReleased
        String s = price.getText(), res = "";
        for (int i = 0; i < s.length(); i ++) {
            if ("0123456789".indexOf(s.charAt(i)) > -1) {
                res += s.charAt(i);
            }
            else {
                Pane p = new Pane(this);
                p.top.setText("Do you thing I'm a fool you fool.");
                p.txt.setText("Type only integer");
                p.yes.setVisible(false);
                p.no.setVisible(false);
                p.setVisible(true);
                break;
            }
        }
        price.setText(res);
    }//GEN-LAST:event_priceKeyReleased

    private void backMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_backMouseClicked
        c.setVisible(true);
        c.stmt = stmt;
        this.dispose();
    }//GEN-LAST:event_backMouseClicked

    private void minimizeMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_minimizeMouseClicked
        this.setVisible(false);
        new Both.Max(this).setVisible(true);
    }//GEN-LAST:event_minimizeMouseClicked

    private void exitMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_exitMouseClicked
        System.exit(0);
    }//GEN-LAST:event_exitMouseClicked

    private void formWindowOpened(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowOpened
        panel.setBackground(new java.awt.Color(10 + (int)(Math.random() * 245), 10 + (int)(Math.random() * 245), 10 + (int)(Math.random() * 245)));
    }//GEN-LAST:event_formWindowOpened

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(UpdateCar.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(UpdateCar.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(UpdateCar.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(UpdateCar.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new UpdateCar().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel back;
    private javax.swing.JButton bdesc;
    private javax.swing.JButton bimg;
    private javax.swing.JLabel blk;
    public javax.swing.JTextArea desc;
    private javax.swing.JLabel exit;
    private javax.swing.JLabel minimize;
    public javax.swing.JTextField name;
    private javax.swing.JLabel nm;
    public javax.swing.JTextField oil;
    private javax.swing.JLabel ol;
    private javax.swing.JPanel panel;
    public javax.swing.JLabel pic;
    private javax.swing.JLabel prc;
    public javax.swing.JTextField price;
    private javax.swing.JScrollPane scrollpane;
    public javax.swing.JTextField trans;
    private javax.swing.JLabel trns;
    private javax.swing.JLabel updt;
    // End of variables declaration//GEN-END:variables
}
